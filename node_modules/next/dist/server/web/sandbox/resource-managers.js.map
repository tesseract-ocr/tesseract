{"version":3,"sources":["../../../../src/server/web/sandbox/resource-managers.ts"],"sourcesContent":["abstract class ResourceManager<T, K> {\n  private resources: T[] = []\n\n  abstract create(resourceArgs: K): T\n  abstract destroy(resource: T): void\n\n  add(resourceArgs: K) {\n    const resource = this.create(resourceArgs)\n    this.resources.push(resource)\n    return resource\n  }\n\n  remove(resource: T) {\n    this.resources = this.resources.filter((r) => r !== resource)\n    this.destroy(resource)\n  }\n\n  removeAll() {\n    this.resources.forEach(this.destroy)\n    this.resources = []\n  }\n}\n\nclass IntervalsManager extends ResourceManager<\n  number,\n  Parameters<typeof setInterval>\n> {\n  create(args: Parameters<typeof setInterval>) {\n    // TODO: use the edge runtime provided `setInterval` instead\n    return setInterval(...args)[Symbol.toPrimitive]()\n  }\n\n  destroy(interval: number) {\n    clearInterval(interval)\n  }\n}\n\nclass TimeoutsManager extends ResourceManager<\n  number,\n  Parameters<typeof setTimeout>\n> {\n  create(args: Parameters<typeof setTimeout>) {\n    // TODO: use the edge runtime provided `setTimeout` instead\n    return setTimeout(...args)[Symbol.toPrimitive]()\n  }\n\n  destroy(timeout: number) {\n    clearTimeout(timeout)\n  }\n}\n\nexport const intervalsManager = new IntervalsManager()\nexport const timeoutsManager = new TimeoutsManager()\n"],"names":["intervalsManager","timeoutsManager","ResourceManager","add","resourceArgs","resource","create","resources","push","remove","filter","r","destroy","removeAll","forEach","IntervalsManager","args","setInterval","Symbol","toPrimitive","interval","clearInterval","TimeoutsManager","setTimeout","timeout","clearTimeout"],"mappings":";;;;;;;;;;;;;;;IAmDaA,gBAAgB;eAAhBA;;IACAC,eAAe;eAAfA;;;AApDb,MAAeC;IAMbC,IAAIC,YAAe,EAAE;QACnB,MAAMC,WAAW,IAAI,CAACC,MAAM,CAACF;QAC7B,IAAI,CAACG,SAAS,CAACC,IAAI,CAACH;QACpB,OAAOA;IACT;IAEAI,OAAOJ,QAAW,EAAE;QAClB,IAAI,CAACE,SAAS,GAAG,IAAI,CAACA,SAAS,CAACG,MAAM,CAAC,CAACC,IAAMA,MAAMN;QACpD,IAAI,CAACO,OAAO,CAACP;IACf;IAEAQ,YAAY;QACV,IAAI,CAACN,SAAS,CAACO,OAAO,CAAC,IAAI,CAACF,OAAO;QACnC,IAAI,CAACL,SAAS,GAAG,EAAE;IACrB;;aAnBQA,YAAiB,EAAE;;AAoB7B;AAEA,MAAMQ,yBAAyBb;IAI7BI,OAAOU,IAAoC,EAAE;QAC3C,4DAA4D;QAC5D,OAAOC,eAAeD,KAAK,CAACE,OAAOC,WAAW,CAAC;IACjD;IAEAP,QAAQQ,QAAgB,EAAE;QACxBC,cAAcD;IAChB;AACF;AAEA,MAAME,wBAAwBpB;IAI5BI,OAAOU,IAAmC,EAAE;QAC1C,2DAA2D;QAC3D,OAAOO,cAAcP,KAAK,CAACE,OAAOC,WAAW,CAAC;IAChD;IAEAP,QAAQY,OAAe,EAAE;QACvBC,aAAaD;IACf;AACF;AAEO,MAAMxB,mBAAmB,IAAIe;AAC7B,MAAMd,kBAAkB,IAAIqB"}