{"version":3,"sources":["../../../../../src/client/components/react-dev-overlay/pages/ReactDevOverlay.tsx"],"sourcesContent":["import * as React from 'react'\n\nimport * as Bus from './bus'\nimport { ShadowPortal } from '../internal/components/ShadowPortal'\nimport { BuildError } from '../internal/container/BuildError'\nimport { Errors } from '../internal/container/Errors'\nimport { ErrorBoundary } from './ErrorBoundary'\nimport { Base } from '../internal/styles/Base'\nimport { ComponentStyles } from '../internal/styles/ComponentStyles'\nimport { CssReset } from '../internal/styles/CssReset'\nimport { useErrorOverlayReducer } from '../shared'\n\ntype ErrorType = 'runtime' | 'build'\n\nconst shouldPreventDisplay = (\n  errorType?: ErrorType | null,\n  preventType?: ErrorType[] | null\n) => {\n  if (!preventType || !errorType) {\n    return false\n  }\n  return preventType.includes(errorType)\n}\n\ninterface ReactDevOverlayProps {\n  children?: React.ReactNode\n  preventDisplay?: ErrorType[]\n  globalOverlay?: boolean\n}\n\nexport default function ReactDevOverlay({\n  children,\n  preventDisplay,\n  globalOverlay,\n}: ReactDevOverlayProps) {\n  const [state, dispatch] = useErrorOverlayReducer()\n\n  React.useEffect(() => {\n    Bus.on(dispatch)\n    return function () {\n      Bus.off(dispatch)\n    }\n  }, [dispatch])\n\n  const onComponentError = React.useCallback(\n    (_error: Error, _componentStack: string | null) => {\n      // TODO: special handling\n    },\n    []\n  )\n\n  const hasBuildError = state.buildError != null\n  const hasRuntimeErrors = Boolean(state.errors.length)\n  const errorType = hasBuildError\n    ? 'build'\n    : hasRuntimeErrors\n      ? 'runtime'\n      : null\n  const isMounted = errorType !== null\n\n  const displayPrevented = shouldPreventDisplay(errorType, preventDisplay)\n\n  return (\n    <>\n      <ErrorBoundary\n        globalOverlay={globalOverlay}\n        isMounted={isMounted}\n        onError={onComponentError}\n      >\n        {children ?? null}\n      </ErrorBoundary>\n      {isMounted ? (\n        <ShadowPortal>\n          <CssReset />\n          <Base />\n          <ComponentStyles />\n\n          {displayPrevented ? null : hasBuildError ? (\n            <BuildError\n              message={state.buildError!}\n              versionInfo={state.versionInfo}\n            />\n          ) : hasRuntimeErrors ? (\n            <Errors\n              isAppDir={false}\n              errors={state.errors}\n              versionInfo={state.versionInfo}\n              initialDisplayState={'fullscreen'}\n            />\n          ) : undefined}\n        </ShadowPortal>\n      ) : undefined}\n    </>\n  )\n}\n"],"names":["React","Bus","ShadowPortal","BuildError","Errors","ErrorBoundary","Base","ComponentStyles","CssReset","useErrorOverlayReducer","shouldPreventDisplay","errorType","preventType","includes","ReactDevOverlay","children","preventDisplay","globalOverlay","state","dispatch","useEffect","on","off","onComponentError","useCallback","_error","_componentStack","hasBuildError","buildError","hasRuntimeErrors","Boolean","errors","length","isMounted","displayPrevented","onError","message","versionInfo","isAppDir","initialDisplayState","undefined"],"mappings":";AAAA,YAAYA,WAAW,QAAO;AAE9B,YAAYC,SAAS,QAAO;AAC5B,SAASC,YAAY,QAAQ,sCAAqC;AAClE,SAASC,UAAU,QAAQ,mCAAkC;AAC7D,SAASC,MAAM,QAAQ,+BAA8B;AACrD,SAASC,aAAa,QAAQ,kBAAiB;AAC/C,SAASC,IAAI,QAAQ,0BAAyB;AAC9C,SAASC,eAAe,QAAQ,qCAAoC;AACpE,SAASC,QAAQ,QAAQ,8BAA6B;AACtD,SAASC,sBAAsB,QAAQ,YAAW;AAIlD,MAAMC,uBAAuB,CAC3BC,WACAC;IAEA,IAAI,CAACA,eAAe,CAACD,WAAW;QAC9B,OAAO;IACT;IACA,OAAOC,YAAYC,QAAQ,CAACF;AAC9B;AAQA,eAAe,SAASG,gBAAgB,KAIjB;IAJiB,IAAA,EACtCC,QAAQ,EACRC,cAAc,EACdC,aAAa,EACQ,GAJiB;IAKtC,MAAM,CAACC,OAAOC,SAAS,GAAGV;IAE1BT,MAAMoB,SAAS,CAAC;QACdnB,IAAIoB,EAAE,CAACF;QACP,OAAO;YACLlB,IAAIqB,GAAG,CAACH;QACV;IACF,GAAG;QAACA;KAAS;IAEb,MAAMI,mBAAmBvB,MAAMwB,WAAW,CACxC,CAACC,QAAeC;IACd,yBAAyB;IAC3B,GACA,EAAE;IAGJ,MAAMC,gBAAgBT,MAAMU,UAAU,IAAI;IAC1C,MAAMC,mBAAmBC,QAAQZ,MAAMa,MAAM,CAACC,MAAM;IACpD,MAAMrB,YAAYgB,gBACd,UACAE,mBACE,YACA;IACN,MAAMI,YAAYtB,cAAc;IAEhC,MAAMuB,mBAAmBxB,qBAAqBC,WAAWK;IAEzD,qBACE;;0BACE,KAACX;gBACCY,eAAeA;gBACfgB,WAAWA;gBACXE,SAASZ;0BAERR,mBAAAA,WAAY;;YAEdkB,0BACC,MAAC/B;;kCACC,KAACM;kCACD,KAACF;kCACD,KAACC;oBAEA2B,mBAAmB,OAAOP,8BACzB,KAACxB;wBACCiC,SAASlB,MAAMU,UAAU;wBACzBS,aAAanB,MAAMmB,WAAW;yBAE9BR,iCACF,KAACzB;wBACCkC,UAAU;wBACVP,QAAQb,MAAMa,MAAM;wBACpBM,aAAanB,MAAMmB,WAAW;wBAC9BE,qBAAqB;yBAErBC;;iBAEJA;;;AAGV"}